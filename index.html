<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CANADA</title>
    <!-- Tải Tailwind CSS để làm giao diện -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Tải font Montserrat từ Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* Đổi font chữ mặc định sang Montserrat */
        body { font-family: 'Montserrat', sans-serif; background-color: #f0f2f5; }
        
        #cover-container {
            height: 80vh;
            color: white;
        }
        .cover-image {
            /* CSS cho các lớp ảnh bìa */
            width: 100%;
            height: 100%;
            background-size: cover;
            background-position: center;
            /* Đây là hiệu ứng "morph" (cross-fade) qua opacity */
            transition: opacity 2s ease-in-out;
        }
        .text-shadow {
             text-shadow: 0 2px 8px rgba(0, 0, 0, 0.7);
        }
        .masonry-container {
            column-gap: 1.25rem;
            padding: 1.25rem;
        }
        .masonry-item {
            display: inline-block;
            width: 100%;
            margin-bottom: 1.25rem;
            break-inside: avoid;
        }
        .masonry-item img {
            width: 100%;
            height: auto;
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            cursor: pointer; /* Thêm con trỏ để báo hiệu có thể click */
        }
        .masonry-item img:hover {
            transform: scale(1.03);
            box-shadow: 0 10px 15px rgba(0, 0, 0, 0.2);
        }
        /* Cài đặt responsive cho số cột */
        @media (min-width: 640px) { .masonry-container { column-count: 2; } }
        @media (min-width: 1024px) { .masonry-container { column-count: 3; } }
        @media (min-width: 1280px) { .masonry-container { column-count: 4; } }
        
        /* CSS cho Lightbox xem ảnh lớn */
        #lightbox.hidden { display: none; }
    </style>
</head>
<body class="bg-white">

    <!-- PHẦN 1: ẢNH BÌA LỚN (đã cập nhật hiệu ứng morph) -->
    <header id="cover-container" class="relative">
        <!-- Lớp ảnh nền 1 -->
        <div id="cover-bg-1" class="absolute inset-0 cover-image" style="background-image: url('https://drive.google.com/thumbnail?id=1SA8J9wtOHTQ3aoUTvdipSGbZe1HcNyMj&sz=w2048');"></div>
        <!-- Lớp ảnh nền 2 (dùng để chuyển đổi) -->
        <div id="cover-bg-2" class="absolute inset-0 cover-image opacity-0" style="background-image: url('');"></div>
        
        <!-- Lớp nội dung chữ (đã bỏ highlight, đổi font) -->
        <div class="relative z-10 h-[80vh] flex items-center justify-center text-shadow">
            <div class="text-center">
                <h1 class="text-5xl md:text-7xl font-bold">CANADA</h1>
                <p class="text-lg md:text-2xl mt-4"></p>
            </div>
        </div>
    </header>

    <!-- PHẦN 2: TIÊU ĐỀ VÀ MÔ TẢ ALBUM -->
    <main class="container mx-auto px-4 py-12">
        <div class="text-center mb-12">
            <h2 class="text-3xl font-bold text-gray-800">huyhung</h2>
            <p class="mt-2 text-gray-600 max-w-2xl mx-auto">4 mois à l'UQTR</p>
        </div>

        <!-- PHẦN 3: LƯỚI ẢNH MASONRY TỰ ĐỘNG -->
        <div id="gallery-container" class="masonry-container">
            <div id="loading-indicator" class="text-center col-span-full">
                <p class="text-gray-600">Đang tải ảnh từ Google Drive...</p>
            </div>
        </div>
    </main>

    <!-- PHẦN 4: CHÂN TRANG -->
    <footer class="bg-gray-800 text-white text-center p-6 mt-8">
        <p>&copy; 2025 Cái này là của Hùng nhé mọi người!!</p>
    </footer>

    <!-- PHẦN 5: LIGHTBOX XEM ẢNH LỚN -->
    <div id="lightbox" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 transition-opacity duration-300">
        <span id="close-lightbox" class="absolute top-5 right-8 text-white text-5xl font-bold cursor-pointer hover:text-gray-300 transition-colors">&times;</span>
        <img id="lightbox-image" src="" alt="Ảnh phóng to" class="max-w-[90vw] max-h-[90vh] rounded-lg shadow-lg">
    </div>


    <!-- ===== PHẦN SCRIPT TỰ ĐỘNG LẤY ẢNH VÀ XỬ LÝ TÍNH NĂNG MỚI ===== -->
    <script>
        const API_KEY = 'AIzaSyD2ZqR4YO0QIWf_4h2idDX1_ohkW2TwGi0'; 
        const FOLDER_ID = '1Ag43jZQLTNs0ShmzWWveU82DUYVaBNPp';

        const galleryContainer = document.getElementById('gallery-container');
        const loadingIndicator = document.getElementById('loading-indicator');
        
        // Elements cho ảnh bìa
        const coverBg1 = document.getElementById('cover-bg-1');
        const coverBg2 = document.getElementById('cover-bg-2');
        let isCover1Active = true;
        
        // Elements cho Lightbox
        const lightbox = document.getElementById('lightbox');
        const lightboxImage = document.getElementById('lightbox-image');
        const closeLightboxBtn = document.getElementById('close-lightbox');

        let imageList = []; // Mảng để lưu tất cả link ảnh

        // Hàm mở Lightbox
        function openLightbox(imageUrl) {
            lightboxImage.src = imageUrl;
            lightbox.classList.remove('hidden');
        }

        // Hàm đóng Lightbox
        function closeLightbox() {
            lightbox.classList.add('hidden');
        }

        closeLightboxBtn.addEventListener('click', closeLightbox);
        lightbox.addEventListener('click', (e) => {
            if (e.target === lightbox) {
                closeLightbox();
            }
        });
        
        // Hàm bắt đầu slideshow cho ảnh bìa với hiệu ứng morph
        function startCoverSlideshow() {
            if (imageList.length > 1) {
                setInterval(() => {
                    const randomIndex = Math.floor(Math.random() * imageList.length);
                    const newImageUrl = imageList[randomIndex];

                    if (isCover1Active) {
                        // Chuyển ảnh cho lớp 2 và làm nó hiện ra
                        coverBg2.style.backgroundImage = `url('${newImageUrl}')`;
                        coverBg2.style.opacity = 1;
                        // Làm mờ lớp 1
                        coverBg1.style.opacity = 0;
                    } else {
                        // Chuyển ảnh cho lớp 1 và làm nó hiện ra
                        coverBg1.style.backgroundImage = `url('${newImageUrl}')`;
                        coverBg1.style.opacity = 1;
                        // Làm mờ lớp 2
                        coverBg2.style.opacity = 0;
                    }
                    isCover1Active = !isCover1Active; // Đảo trạng thái
                }, 5000); // Đổi ảnh mỗi 5 giây
            }
        }

        async function fetchImages() {
            const apiUrl = `https://www.googleapis.com/drive/v3/files?q='${FOLDER_ID}'+in+parents+and+(mimeType='image/jpeg'+or+mimeType='image/png')&key=${API_KEY}&fields=files(id,name)`;

            try {
                const response = await fetch(apiUrl);
                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(`Lỗi API: ${errorData.error.message || response.statusText}`);
                }
                const data = await response.json();

                if (loadingIndicator) loadingIndicator.remove();

                if (data.files && data.files.length > 0) {
                    imageList = data.files.map(file => `https://drive.google.com/thumbnail?id=${file.id}&sz=w2048`);

                    imageList.forEach(imageUrl => {
                        const masonryItem = document.createElement('div');
                        masonryItem.className = 'masonry-item';
                        
                        const img = document.createElement('img');
                        img.src = imageUrl;
                        img.alt = 'Ảnh từ Google Drive';
                        img.loading = 'lazy';
                        
                        img.addEventListener('click', () => openLightbox(imageUrl));
                        
                        masonryItem.appendChild(img);
                        galleryContainer.appendChild(masonryItem);
                    });

                    startCoverSlideshow();

                } else {
                     galleryContainer.innerHTML = '<p class="text-center col-span-full">Không tìm thấy ảnh nào trong thư mục.</p>';
                }

            } catch (error) {
                console.error('Không thể lấy ảnh từ Google Drive:', error);
                if(galleryContainer) galleryContainer.innerHTML = `<p class="text-red-600 font-bold text-center col-span-full">Đã xảy ra lỗi khi tải ảnh. Vui lòng kiểm tra lại cấu hình API và chia sẻ thư mục.</p>`;
            }
        }

        fetchImages();
    </script>

</body>
</html>

